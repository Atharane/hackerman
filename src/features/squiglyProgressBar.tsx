import { motion } from "framer-motion"

import Tooltip from "~components/ui/tooltip"

const SquiglyProgressBar = ({
  progress,
  total,
  className
}: {
  progress: number
  total: number
  className?: string
}) => {
  const percentage = Math.floor((progress / total) * 100)
  const OFFSET = 0.05
  const progressOffset =
    percentage === 100 ? 1 : Math.max(percentage / 100 - OFFSET, 0)
  const remainderOffset =
    percentage === 100 ? 0 : Math.min(percentage / 100 + OFFSET, 1)

  return (
    <div className={`${className} group relative`}>
      <div className="invisible group-hover:visible">
        <Tooltip
          text={`${progress} solved ${total - progress} more to go...`}
        />
      </div>
      <svg
        width="300"
        height="30"
        viewBox="0 0 300 30"
        fill="none"
        xmlns="http://www.w3.org/2000/svg">
        <path
          d="M3.75 30C11.6345 30 15.6408 23.4326 18.8598 18.1543C22.0385 12.9468 24.0381 10 28.1543 10C32.2705 10 34.2663 12.9468 37.445 18.1543C40.664 23.4326 44.6703 30 52.5549 30C60.4357 30 64.442 23.4302 67.661 18.1519C70.8324 12.9468 72.8319 10 76.9408 10C81.046 10 83.0419 12.9468 86.2132 18.1519C89.4286 23.4302 93.4313 30 101.308 30C109.186 30 113.188 23.4326 116.407 18.1543C119.579 12.9468 121.575 10 125.687 10C129.792 10 131.788 12.9444 134.96 18.1519C138.175 23.4302 142.178 30 150.058 30C157.936 30 161.938 23.4326 165.154 18.1543C168.325 12.9468 170.321 10 174.43 10C178.535 10 180.531 12.9444 183.702 18.1519C186.917 23.4302 190.92 30 198.801 30C206.678 30 210.677 23.4302 213.892 18.1519C217.064 12.9468 219.056 10 223.161 10C227.263 10 229.259 12.9468 232.426 18.1519C235.638 23.4302 239.637 30 247.511 30C255.391 30 259.394 23.4302 262.609 18.1519C265.781 12.9444 267.777 10 271.882 10C275.987 10 277.983 12.9468 281.154 18.1519C284.37 23.4302 288.372 30 296.25 30C298.322 30 300 27.7612 300 25C300 22.2388 298.322 20 296.25 20C292.144 20 290.148 17.0532 286.977 11.8482C283.762 6.56986 279.759 4.95911e-05 271.882 4.95911e-05C264.005 4.95911e-05 260.002 6.56742 256.787 11.8457C253.615 17.0532 251.619 20 247.511 20C243.409 20 241.417 17.0557 238.249 11.8506C235.037 6.56986 231.035 4.95911e-05 223.161 4.95911e-05C215.284 4.95911e-05 211.285 6.56986 208.07 11.8482C204.898 17.0532 202.906 20 198.801 20C194.692 20 192.696 17.0532 189.525 11.8457C186.31 6.56742 182.307 4.95911e-05 174.43 4.95911e-05C166.549 4.95911e-05 162.546 6.56986 159.331 11.8482C156.159 17.0557 154.164 20 150.058 20C145.949 20 143.954 17.0532 140.782 11.8457C137.567 6.56742 133.564 4.95911e-05 125.687 4.95911e-05C117.806 4.95911e-05 113.804 6.56986 110.585 11.8482C107.413 17.0532 105.417 20 101.308 20C97.2032 20 95.2074 17.0532 92.036 11.8482C88.8207 6.56986 84.818 4.95911e-05 76.9408 4.95911e-05C69.0599 4.95911e-05 65.0573 6.56742 61.8383 11.8457C58.6632 17.0532 56.6674 20 52.5549 20C48.4387 20 46.4391 17.0532 43.2604 11.8433C40.0414 6.56742 36.0351 4.95911e-05 28.1543 4.95911e-05C20.2698 4.95911e-05 16.2634 6.56742 13.0444 11.8457C9.86573 17.0532 7.8662 20 3.75 20C1.67725 20 0 22.2388 0 25C0 27.7612 1.67725 30 3.75 30Z"
          fill="url(#paint0_linear_19_7)"
        />
        <defs>
          <linearGradient
            id="paint0_linear_19_7"
            x1="0"
            y1="15"
            x2="300"
            y2="15"
            gradientUnits="userSpaceOnUse">
            <motion.stop
              initial={{ offset: 0 }}
              animate={{ offset: progressOffset }}
              transition={{ duration: 1.5 }}
              stopColor="orange"
            />
            <stop offset={remainderOffset} stopColor="white" />
          </linearGradient>
        </defs>
      </svg>
    </div>
  )
}

export default SquiglyProgressBar
